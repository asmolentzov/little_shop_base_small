<% if @cart.contents.empty? %>
  <p>Your cart is empty</p>
<% else %>
  <div id="coupon">    
    <% if @applied_coupon %>
      <p>Subtotal: <%= number_to_currency@cart.pre_discount_total %></p>
      <% if @applied_coupon.coupon_type == 'percentage' %>
        <p>Coupon <%= @applied_coupon.code %> discount: <%= @applied_coupon.amount %>%</p>
      <% else %>
        <p>Coupon <%= @applied_coupon.code %> discount: <%= number_to_currency(@applied_coupon.amount) %></p>
        <p><%= number_to_currency(@applied_coupon.cart_minimum) %> cart minimum amount</p>
      <% end %>
      <%= button_to 'Remove Coupon', remove_coupon_path %>
    <% else %>
      Add Coupon:
      <%= form_for @coupon, url: apply_coupon_path do |f| %>
        <%= f.label :coupon_code %>
        <%= f.text_field :code %>
        <%= f.submit 'Apply Coupon' %>
      <% end %>
    <% end %>
  </div>
  <p>Grand Total: <%= number_to_currency(@cart.grand_total(@applied_coupon)) %></p>

  <%= button_to "Empty cart", cart_empty_path, method: :delete %>

  <% if current_user %>
    <%= button_to 'Check out', profile_orders_path %>
  <% else %>
    You must
    <%= link_to 'register', registration_path %>
    or
    <%= link_to 'log in', login_path %>
    to check out.
  <% end %>

  <% @items.each do |item| %>
    <%= tag.div id: "item-#{item.id}" do %>
      <%= render partial: "cart_item", locals: {item: item, img_width: 150} %>
    <% end %>
  <% end %>
<% end %>